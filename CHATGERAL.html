<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Geral - Agente Da Noite</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .chat-container {
            max-width: 800px;
            margin: 20px auto;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff0000;
            border-radius: 15px;
            box-shadow: 0 0 30px #ff0000;
            overflow: hidden;
        }

        .chat-header {
            background: rgba(255, 0, 0, 0.2);
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #ff0000;
        }

        .chat-title {
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
            margin: 0;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 0, 0, 0.1);
            border-left: 3px solid #ff0000;
        }

        .message-user {
            color: #ff0000;
            font-weight: bold;
            text-shadow: 0 0 5px #ff0000;
        }

        .message-text {
            color: white;
            margin-top: 5px;
        }

        .message-time {
            color: #ccc;
            font-size: 0.8em;
            float: right;
        }

        .chat-input-container {
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 2px solid #ff0000;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        #messageInput {
            flex: 1;
            padding: 12px;
            border: 2px solid #ff0000;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
        }

        #sendMessage {
            padding: 12px 20px;
            background: linear-gradient(45deg, #ff0000, #ff6b6b);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-shadow: 0 0 10px white;
            box-shadow: 0 0 15px #ff0000;
        }

        .user-info {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
        }

        #userName {
            padding: 8px;
            border: 2px solid #ff0000;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            flex: 1;
        }

        .online-users {
            background: rgba(255, 0, 0, 0.1);
            padding: 10px;
            border-bottom: 1px solid #ff0000;
            font-size: 0.9em;
            color: #00ff00;
            text-align: center;
        }
    </style>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="furia.png" alt="Agente Da Noite" class="logo">
            <h1 class="neon-text">AGENTE DA NOITE</h1>
        </div>
        <nav class="main-nav">
            <a href="index.html" class="nav-link neon-text">Início</a>
            <a href="agente-da-noite.html" class="nav-link neon-text">Agente Da Noite</a>
            <a href="fron.html" class="nav-link neon-text">FRØN</a>
            <a href="campeonato.html" class="nav-link neon-text">Campeonato</a>
            <a href="regras.html" class="nav-link neon-text">Regras</a>
            <a href="chatgeral.html" class="nav-link neon-text">Chat</a>
            <a href="login.html" class="nav-link neon-btn">Login</a>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h1 class="neon-title">💬 CHAT GERAL</h1>
            <p class="neon-subtitle">Converse com a comunidade Agente Da Noite em tempo real!</p>
        </section>

        <div class="chat-container">
            <div class="chat-header">
                <h2 class="chat-title">CHAT DA COMUNIDADE</h2>
            </div>
            
            <div class="online-users" id="onlineUsers">
                🔥 Online: <span id="usersCount">0</span> usuários
            </div>
            
            <div class="user-info">
                <input type="text" id="userName" placeholder="Digite seu nome para entrar no chat..." maxlength="20">
                <button onclick="setUserName()" class="btn-neon">Entrar</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message">
                    <span class="message-user">Sistema:</span>
                    <span class="message-text">Bem-vindo ao chat do Agente Da Noite! Digite seu nome e comece a conversar.</span>
                    <span class="message-time" id="currentTime"></span>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="Digite sua mensagem..." maxlength="200" disabled>
                    <button id="sendMessage" onclick="sendMessage()" disabled>Enviar</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Agente Da Noite - <strong>ToxicSkull√</strong></p>
    </footer>

    <script>
        // 🔥 CONFIGURAÇÃO DO FIREBASE - JÁ CONFIGURADO!
        const firebaseConfig = {
            apiKey: "AIzaSyCSLmGZRL0Ia16-nBbyqACh91qAdzYUUBI",
            authDomain: "furiadanoiteplay-af94d.firebaseapp.com",
            databaseURL: "https://furiadanoiteplay-af94d-default-rtdb.firebaseio.com",
            projectId: "furiadanoiteplay-af94d",
            storageBucket: "furiadanoiteplay-af94d.firebasestorage.app",
            messagingSenderId: "401991505133",
            appId: "1:401991505133:web:7e499ef2fc45c2f69aa8e4"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let userName = '';
        let userColor = '';

        function setUserName() {
            const nameInput = document.getElementById('userName');
            const name = nameInput.value.trim();
            
            if (name) {
                userName = name;
                userColor = generateColor();
                
                // Ativar chat
                document.getElementById('messageInput').disabled = false;
                document.getElementById('sendMessage').disabled = false;
                nameInput.disabled = true;
                
                // Adicionar usuário online
                const userRef = database.ref('onlineUsers/' + Date.now());
                userRef.set({
                    name: userName,
                    color: userColor,
                    timestamp: Date.now()
                });
                
                // Remover usuário quando sair
                window.addEventListener('beforeunload', () => {
                    userRef.remove();
                });
                
                // Atualizar contagem de usuários online
                updateOnlineUsers();
            } else {
                alert('Por favor, digite seu nome!');
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message && userName) {
                // Salvar mensagem no Firebase
                database.ref('messages').push().set({
                    user: userName,
                    text: message,
                    color: userColor,
                    timestamp: Date.now()
                });
                
                messageInput.value = '';
            }
        }

        function generateColor() {
            const colors = ['#ff0000', '#ff6b6b', '#ffa500', '#00ff00', '#00ffff', '#ff00ff', '#ffff00'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function updateOnlineUsers() {
            const usersRef = database.ref('onlineUsers');
            usersRef.on('value', (snapshot) => {
                const users = snapshot.val();
                const count = users ? Object.keys(users).length : 0;
                document.getElementById('usersCount').textContent = count;
            });
        }

        // Carregar mensagens
        database.ref('messages').limitToLast(50).on('child_added', (snapshot) => {
            const message = snapshot.val();
            displayMessage(message);
        });

        function displayMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `
                <span class="message-user" style="color: ${message.color}">${message.user}:</span>
                <span class="message-text">${message.text}</span>
                <span class="message-time">${new Date(message.timestamp).toLocaleTimeString()}</span>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Enter para enviar mensagem
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Atualizar hora atual
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Limpar mensagens antigas (manter só as últimas 100)
        setInterval(() => {
            database.ref('messages').once('value').then((snapshot) => {
                const messages = snapshot.val();
                if (messages && Object.keys(messages).length > 100) {
                    const keys = Object.keys(messages);
                    const toDelete = keys.slice(0, keys.length - 100);
                    toDelete.forEach(key => {
                        database.ref('messages/' + key).remove();
                    });
                }
            });
        }, 60000); // A cada minuto
    </script>
</body>
</html>