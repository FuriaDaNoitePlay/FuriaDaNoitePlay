<!-- ADICIONAR AP√ìS O √öLTIMO </script> E ANTES DO </body> -->
<script>
// ==================== SISTEMA DE COMUNICA√á√ÉO DA RIFA ====================

// Fun√ß√£o para comunicar sele√ß√£o com outras p√°ginas
function comunicarSelecaoParaSistema() {
    console.log('üì§ Comunicando sele√ß√£o para o sistema...');
    
    if (selectedNumbers.length === 0) {
        console.log('‚ö†Ô∏è Nenhum n√∫mero selecionado para comunicar');
        return;
    }
    
    try {
        // Obter dados do localStorage
        const numerosSelecionados = JSON.parse(
            localStorage.getItem('rifa_com_selecionados') || '[]'
        );
        
        const numerosPendentes = JSON.parse(
            localStorage.getItem('rifa_com_pendentes') || '[]'
        );
        
        // Obter nome do usu√°rio
        const nomeUsuario = prompt('Por favor, digite seu nome para confirmar a sele√ß√£o:') || 'An√¥nimo';
        
        // Para cada n√∫mero selecionado
        selectedNumbers.forEach(item => {
            const numero = item.number;
            
            // Verificar se n√∫mero j√° foi selecionado
            if (numerosSelecionados.includes(numero)) {
                alert(`‚ö†Ô∏è O n√∫mero ${numero} j√° foi selecionado por outra pessoa!`);
                return;
            }
            
            // Adicionar √† lista de selecionados
            numerosSelecionados.push(numero);
            
            // Adicionar √† lista de pendentes
            numerosPendentes.push({
                numero: numero,
                usuario: nomeUsuario,
                timestamp: Date.now(),
                data: new Date().toISOString()
            });
            
            console.log(`‚úÖ N√∫mero ${numero} adicionado √†s listas de comunica√ß√£o`);
        });
        
        // Salvar no localStorage
        localStorage.setItem('rifa_com_selecionados', JSON.stringify(numerosSelecionados));
        localStorage.setItem('rifa_com_pendentes', JSON.stringify(numerosPendentes));
        
        // Salvar como √∫ltima sele√ß√£o (para notifica√ß√£o)
        const ultimaSelecao = {
            numeros: selectedNumbers.map(item => item.number),
            usuario: nomeUsuario,
            timestamp: Date.now(),
            total: selectedNumbers.length * pricePerNumber
        };
        
        localStorage.setItem('rifa_com_ultimo', JSON.stringify(ultimaSelecao));
        
        // Marcar n√∫meros como reservados na interface
        marcarNumerosComoReservados();
        
        // Mostrar confirma√ß√£o
        alert(`‚úÖ Sele√ß√£o comunicada com sucesso!\n\nüìä N√∫meros: ${selectedNumbers.map(n => n.number).join(', ')}\nüë§ Nome: ${nomeUsuario}\nüí∞ Total: R$ ${(selectedNumbers.length * pricePerNumber).toFixed(2)}\n\nüì± O WhatsApp j√° est√° aberto com sua mensagem. Envie o comprovante para confirmar!`);
        
        console.log('üéØ Sele√ß√£o comunicada com sucesso ao sistema!');
        
    } catch (error) {
        console.error('‚ùå Erro ao comunicar sele√ß√£o:', error);
        alert('‚ùå Erro ao processar sua sele√ß√£o. Por favor, tente novamente.');
    }
}

// Marcar n√∫meros como reservados na interface
function marcarNumerosComoReservados() {
    selectedNumbers.forEach(item => {
        const card = document.querySelector(`.warrior-card[data-number="${item.number}"]`);
        if (card) {
            card.classList.remove('selected');
            card.classList.add('reserved');
            card.querySelector('.warrior-number').textContent = '‚úì';
            card.querySelector('.warrior-number').style.color = '#00ff00';
        }
    });
}

// Verificar status dos n√∫meros ao carregar a p√°gina
function verificarStatusNumeros() {
    console.log('üîç Verificando status dos n√∫meros...');
    
    const numerosSelecionados = JSON.parse(
        localStorage.getItem('rifa_com_selecionados') || '[]'
    );
    
    const numerosConfirmados = JSON.parse(
        localStorage.getItem('rifa_com_confirmados') || '[]'
    );
    
    // Para cada n√∫mero de 1 a 31
    for (let i = 1; i <= 31; i++) {
        const card = document.querySelector(`.warrior-card[data-number="${i}"]`);
        if (!card) continue;
        
        if (numerosConfirmados.includes(i)) {
            // N√∫mero confirmado (vendido)
            card.classList.add('reserved');
            card.querySelector('.warrior-number').textContent = '‚úì';
            card.querySelector('.warrior-number').style.color = '#00ff00';
            card.querySelector('.warrior-label').textContent = 'CONFIRMADO';
            card.querySelector('.warrior-label').style.color = '#00ff00';
            card.style.cursor = 'not-allowed';
            card.title = 'Este n√∫mero j√° foi vendido e confirmado';
        } else if (numerosSelecionados.includes(i)) {
            // N√∫mero selecionado (pendente)
            card.classList.add('reserved');
            card.querySelector('.warrior-number').textContent = '‚è≥';
            card.querySelector('.warrior-number').style.color = '#ffa500';
            card.querySelector('.warrior-label').textContent = 'PENDENTE';
            card.querySelector('.warrior-label').style.color = '#ffa500';
            card.style.cursor = 'not-allowed';
            card.title = 'Este n√∫mero est√° aguardando confirma√ß√£o de pagamento';
        }
    }
    
    console.log('‚úÖ Status dos n√∫meros verificado');
}

// Atualizar bot√£o de confirma√ß√£o para incluir comunica√ß√£o
function atualizarBotaoConfirmacao() {
    const originalConfirmHandler = confirmBtn.onclick;
    
    confirmBtn.onclick = function() {
        if (selectedNumbers.length === 0) {
            alert('Por favor, selecione pelo menos um n√∫mero para participar!');
            return;
        }
        
        // Verificar se algum n√∫mero j√° est√° reservado
        const numerosSelecionados = JSON.parse(
            localStorage.getItem('rifa_com_selecionados') || '[]'
        );
        
        const numerosConfirmados = JSON.parse(
            localStorage.getItem('rifa_com_confirmados') || '[]'
        );
        
        const numerosIndisponiveis = selectedNumbers.filter(item => 
            numerosSelecionados.includes(item.number) || 
            numerosConfirmados.includes(item.number)
        );
        
        if (numerosIndisponiveis.length > 0) {
            const numerosLista = numerosIndisponiveis.map(item => item.number).join(', ');
            alert(`‚ö†Ô∏è Os seguintes n√∫meros j√° foram selecionados por outras pessoas: ${numerosLista}\n\nPor favor, escolha outros n√∫meros.`);
            
            // Remover n√∫meros indispon√≠veis da sele√ß√£o
            selectedNumbers = selectedNumbers.filter(item => 
                !numerosSelecionados.includes(item.number) && 
                !numerosConfirmados.includes(item.number)
            );
            
            // Atualizar interface
            updateSelectedNumbersDisplay();
            updateTotalPrice();
            updateWhatsAppButton();
            
            // Remover sele√ß√£o visual dos cart√µes
            document.querySelectorAll('.warrior-card').forEach(card => {
                const num = parseInt(card.dataset.number);
                if (numerosIndisponiveis.some(item => item.number === num)) {
                    card.classList.remove('selected');
                }
            });
            
            return;
        }
        
        // Ordenar por n√∫mero
        selectedNumbers.sort((a, b) => a.number - b.number);
        
        // Criar mensagem detalhada para WhatsApp
        const total = selectedNumbers.length * pricePerNumber;
        
        const message = `üì± *CONFIRMA√á√ÉO DE SELE√á√ÉO - RIFA DO GUERREIRO* üì±

‚úÖ *N√öMEROS SELECIONADOS:*
${selectedNumbers.map(item => `‚û§ ${item.number} - ${item.name}`).join('\n')}

üí∞ *VALOR TOTAL:* R$ ${total.toFixed(2).replace('.', ',')}
üìß *CHAVE PIX:* furiadanoiteplay2025@gmail.com

üë§ *MEU NOME:* [DIGITE SEU NOME AQUI]

üìã *INSTRU√á√ïES:*
1Ô∏è‚É£ Vou fazer o PIX agora mesmo
2Ô∏è‚É£ Envio o comprovante nesta conversa
3Ô∏è‚É£ Aguardo a confirma√ß√£o dos meus n√∫meros

üéÆ *FuriaDaNoitePlay - Comunidade MLBB* üéÆ`;
        
        // Abrir WhatsApp automaticamente
        window.open(`https://wa.me/553197319008?text=${encodeURIComponent(message)}`, '_blank');
        
        // Comunicar sele√ß√£o para o sistema
        comunicarSelecaoParaSistema();
    };
}

// Configurar prote√ß√£o do bot√£o ADM
function configurarProtecaoADM() {
    document.querySelector('.admin-btn').addEventListener('click', function(e) {
        // Verificar se j√° est√° logado
        const adminLoggedIn = localStorage.getItem('adminLoggedIn');
        const loginTime = localStorage.getItem('adminLoginTime');
        
        if (adminLoggedIn && loginTime) {
            // Verificar tempo da sess√£o (8 horas)
            const sessionTime = 8 * 60 * 60 * 1000;
            const now = Date.now();
            
            if (now - parseInt(loginTime) <= sessionTime) {
                // Sess√£o v√°lida, permitir acesso
                return true;
            } else {
                // Sess√£o expirada
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');
            }
        }
        
        // Solicitar senha
        const password = prompt('üîê DIGITE A SENHA DE ACESSO AO PAINEL ADM:');
        if (password !== 'FuriaMLBB2024!') {
            e.preventDefault();
            alert('‚ùå SENHA INCORRETA! ACESSO NEGADO.');
        } else {
            // Salvar login
            localStorage.setItem('adminLoggedIn', 'true');
            localStorage.setItem('adminLoginTime', Date.now().toString());
        }
    });
}

// Inicializar sistema de comunica√ß√£o
function inicializarSistemaComunicacao() {
    console.log('üîó Inicializando sistema de comunica√ß√£o da rifa...');
    
    // Verificar se existem dados de comunica√ß√£o
    if (!localStorage.getItem('rifa_com_selecionados')) {
        localStorage.setItem('rifa_com_selecionados', JSON.stringify([]));
        localStorage.setItem('rifa_com_confirmados', JSON.stringify([]));
        localStorage.setItem('rifa_com_pendentes', JSON.stringify([]));
        console.log('üìÅ Dados de comunica√ß√£o inicializados');
    }
    
    // Verificar status dos n√∫meros
    verificarStatusNumeros();
    
    // Atualizar bot√£o de confirma√ß√£o
    atualizarBotaoConfirmacao();
    
    // Configurar prote√ß√£o ADM
    configurarProtecaoADM();
    
    // Configurar ouvinte para atualiza√ß√µes do ADM
    window.addEventListener('storage', function(event) {
        if (event.key === 'rifa_com_confirmados') {
            console.log('üîÑ Atualizando status dos n√∫meros confirmados...');
            verificarStatusNumeros();
        }
    });
    
    console.log('‚úÖ Sistema de comunica√ß√£o inicializado!');
}

// Inicializar quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
    // Aguardar um pouco para garantir que tudo esteja carregado
    setTimeout(inicializarSistemaComunicacao, 1000);
});

// Atualizar bot√£o do WhatsApp dinamicamente
function atualizarBotaoWhatsAppComComunicacao() {
    const originalUpdateWhatsAppButton = updateWhatsAppButton;
    
    updateWhatsAppButton = function() {
        whatsappBtnContainer.innerHTML = '';
        
        if (selectedNumbers.length === 0) {
            // Bot√£o padr√£o quando n√£o h√° sele√ß√£o
            const defaultBtn = document.createElement('a');
            defaultBtn.href = `https://wa.me/553197319008?text=${encodeURIComponent('Ol√°! Gostaria de participar da Rifa do Guerreiro.')}`;
            defaultBtn.className = 'whatsapp-btn';
            defaultBtn.target = '_blank';
            defaultBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Enviar Comprovante no WhatsApp';
            whatsappBtnContainer.appendChild(defaultBtn);
            return;
        }
        
        // Ordenar por n√∫mero
        selectedNumbers.sort((a, b) => a.number - b.number);
        
        // Criar mensagem detalhada para WhatsApp
        const total = selectedNumbers.length * pricePerNumber;
        
        const message = `üì± *CONFIRMA√á√ÉO DE SELE√á√ÉO - RIFA DO GUERREIRO* üì±

‚úÖ *N√öMEROS SELECIONADOS:*
${selectedNumbers.map(item => `‚û§ ${item.number} - ${item.name}`).join('\n')}

üí∞ *VALOR TOTAL:* R$ ${total.toFixed(2).replace('.', ',')}
üìß *CHAVE PIX:* furiadanoiteplay2025@gmail.com

üë§ *MEU NOME:* [DIGITE SEU NOME AQUI]

üìã *INSTRU√á√ïES:*
1Ô∏è‚É£ Vou fazer o PIX agora mesmo
2Ô∏è‚É£ Envio o comprovante nesta conversa
3Ô∏è‚É£ Aguardo a confirma√ß√£o dos meus n√∫meros

üéÆ *FuriaDaNoitePlay - Comunidade MLBB* üéÆ`;
        
        const whatsappBtn = document.createElement('a');
        whatsappBtn.href = `https://wa.me/553197319008?text=${encodeURIComponent(message)}`;
        whatsappBtn.className = 'whatsapp-btn';
        whatsappBtn.target = '_blank';
        whatsappBtn.innerHTML = '<i class="fab fa-whatsapp"></i> ENVIAR COMPROVANTE NO WHATSAPP';
        whatsappBtn.id = 'dynamicWhatsAppBtn';
        
        // Adicionar evento para comunica√ß√£o do sistema
        whatsappBtn.addEventListener('click', function(e) {
            // N√£o prevenir o comportamento padr√£o (abrir WhatsApp)
            // A comunica√ß√£o do sistema ser√° feita pelo bot√£o CONFIRMAR SELE√á√ÉO
        });
        
        whatsappBtnContainer.appendChild(whatsappBtn);
    };
    
    // Substituir a fun√ß√£o original
    updateWhatsAppButton();
}

// Substituir a fun√ß√£o updateWhatsAppButton
atualizarBotaoWhatsAppComComunicacao();

// Adicionar Font Awesome se n√£o estiver presente
if (!document.querySelector('link[href*="font-awesome"]')) {
    const fontAwesomeLink = document.createElement('link');
    fontAwesomeLink.rel = 'stylesheet';
    fontAwesomeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
    document.head.appendChild(fontAwesomeLink);
}

console.log('üéÆ Sistema de Rifa do Guerreiro com Comunica√ß√£o carregado!');
    </script>
